# Blood Cell Type Reference Generation

This document outlines the process to reproduce the `blood-cell-type-reference.csv.gz` file. This file contains the top 1,000 cell-type-specific unmethylated markers (hg19 coordinates) derived from Supplementary Table S4C of Loyfer et al., 2023.

The process involves downloading the reference data and methylation beta values, and then using `wgbstools` to generate the final table.

---

### Data and Software Requirements

* **`wgbstools`**: A command-line tool for processing whole-genome bisulfite sequencing data.
* **`blood-cell-type-reference.bed`**: A BED file containing the hg19 coordinates of the cell-type-specific unmethylated markers. This corresponds to the `data/blood-cell-types-regions.bed` file in the [methylhead GitHub repository](https://github.com/MRCIEU/methylhead).
* **Beta files**: Methylation beta values for various blood cell types, obtained from the GEO repository (accession GSE186458).
* **`column`**: A standard Unix command-line utility for formatting text.

---

### Step-by-Step Reproduction

1.  **Download Data**

    A shell script is used to download the required beta files from the GEO repository.

    ```bash
    bash ./scripts/blood-cell-type-download.sh <output-dir>
    ```
    This script will download the necessary data into the specified `<output-dir>`.

2.  **Prepare Target Regions BED File**

    A sorted BED file named `target-regions.bed` is required. It is generated by extracting only the chromosome, start, and end columns from the `blood-cell-type-reference.bed` file.

3.  **Convert Beta Files to Table**

    The core step uses the `wgbstools beta_to_table` command. This tool processes the downloaded beta files against the genomic regions defined in the BED file to create a comprehensive table. The output is then formatted into a clean, tab-separated file using `column -t`.

    ```
    wgbstools beta_to_table blood-cell-type-reference.bed --betas <beta-files> | column -t > blood-cell-type-reference.csv
    ```
    * Replace `<beta-files>` with the paths to the downloaded beta value files.

---

### Reference

* **Loyfer, N., … Kaplan, T. (2023).** A DNA methylation atlas of normal human cell types. *Nature, 613*(7943), 355–364. (PMID [36599988](https://pubmed.ncbi.nlm.nih.gov/36599988/)).
* **Methylhead GitHub Repository:** [https://github.com/MRCIEU/methylhead/tree/main/data](https://github.com/MRCIEU/methylhead/tree/main/data)